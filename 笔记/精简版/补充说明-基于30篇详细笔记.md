# 七章精简版补充说明

> 基于30篇详细笔记的增强版本  
> 最后更新：2025年1月

---

## 📋 补充内容总览

本文档说明了对七章精简版的补充内容，这些补充来自原30篇详细笔记的核心知识点。

---

## 🔄 各章补充内容详情

### A1 - 计算机系统概述

**新增内容**：
- ✅ 高频考题示例（性能计算、Amdahl定律、Cache性能）
- ✅ 分支预测和流水线冒险检查项

**关键补充**：
```
性能计算三步：
  1. 计算时钟周期 = 1/频率
  2. 执行时间 = 指令数 × CPI × 时钟周期
  3. 加速比 = 优化前/优化后

Amdahl定律：S = 1 / [(1-P) + P/N]
  • P：可并行部分比例
  • N：处理器数量
```

---

### A2 - 数据表示与运算

**新增内容**：
- ✅ 四种舍入模式详细对比（就近舍入为IEEE754默认）
- ✅ 精度损失的三大场景（大数+小数、相近数相减、连续运算）
- ✅ 误差控制的实用策略

**关键补充**：
```
就近舍入（Round to nearest even）⭐
  • 最接近的值
  • 等距离时取偶数（避免累积误差）
  • IEEE754默认模式

精度损失避免方法：
  1. 使用双精度（double）
  2. 避免大数+小数
  3. 避免相近数相减
  4. 使用整数运算
```

---

### A3 - 指令系统与寻址

**新增内容**：
- ✅ 有效地址计算的三个高频考题
- ✅ 完整的寻址方式公式汇总

**关键补充**：
```
有效地址计算公式：
  • 直接寻址：EA = A
  • 寄存器寻址：EA在寄存器中
  • 基址寻址：EA = (Rb) + d
  • 变址寻址：EA = (Ix) + d
  • 基址+变址：EA = (Rb) + (Ix) + d
  • 寄存器间接：EA = (R)
  • 间接寻址：EA = (A)
```

---

### A4 - 处理器结构与控制

**新增内容**：
- ✅ 数据冒险详解（RAW最常见）
- ✅ 分支预测算法详解（静态/动态/混合）
- ✅ 分支目标缓冲(BTB)概念

**关键补充**：
```
数据冒险解决方案：
  • 前递技术：从EX/MEM直接转发（无延迟）⭐
  • 阻塞技术：插入气泡等待（有延迟）

分支预测：
  • 静态：总是跳转/不跳转/BTFN
  • 动态：2位饱和计数器 ⭐
  • 混合：结合局部+全局预测器

BTB（分支目标缓冲）：
  • 缓存分支地址和目标地址
  • 减少取指延迟
```

---

### A5 - 存储系统

**新增内容**：
- ✅ Cache一致性协议详解（MESI四态）
- ✅ 多级Cache结构说明
- ✅ 写失效vs写更新的区别

**关键补充**：
```
MESI协议（多核Cache一致性）：
  • M态：Modified - 数据被修改，只在一个Cache
  • E态：Exclusive - 数据独占，与主存一致
  • S态：Shared - 数据共享，多个Cache相同
  • I态：Invalid - 数据无效

多级Cache结构：
  • L1：分数据/指令Cache，每核独占（32-64KB）
  • L2：每核独占（256KB-1MB）
  • L3：多核共享（8-64MB）

一致性维护：
  • 写失效：修改时其他核副本失效
  • 写更新：修改时其他核同步更新
```

---

### A6 - 总线与I/O系统

**新增内容**：
- ✅ DMA与Cache冲突的三种解决方案
- ✅ 中断嵌套处理
- ✅ 总线冲突和仲裁

**关键补充**：
```
DMA与Cache冲突（高频考点）：
  问题：DMA绕过CPU直接访存 → Cache数据不一致
  
  解决方案：
    1. 硬件：Cache一致性协议（MESI）
    2. 软件：DMA前清空Cache / DMA后刷新Cache
    3. 混合：DMA通知Cache更新

中断处理流程：
  1. CPU完成当前指令
  2. 保存现场（PC、PSW）
  3. 分析中断源
  4. 执行ISR
  5. 恢复现场

中断嵌套：
  • 高优先级可打断低优先级ISR
  • 需要保存多层现场
```

---

### A7 - 程序执行与优化

**新增内容**：
- ✅ 栈帧结构详细图示
- ✅ 执行时间计算例题
- ✅ 性能优化的陷阱示例

**关键补充**：
```
栈帧布局（高→低地址）：
  ┌─────────────┐
  │ 返回地址    │ ← CALL自动压入
  ├─────────────┤
  │ 参数 b      │ ← 从右到左
  ├─────────────┤
  │ 参数 a      │
  ├─────────────┤
  │ 旧BP        │ ← PUSH EBP
  ├─────────────┤
  │ 局部变量    │ ← SUB ESP, size
  └─────────────┘

执行时间公式：
  执行时间 = 指令数 × CPI / 时钟频率

优化陷阱：
  • 指令减少不一定加速（CPI可能增加）
  • 需要综合考虑指令数、CPI、频率三个因素
```

---

## 🎯 高频考点速查

### 必考重点（⭐⭐⭐）

| 考点 | 关键内容 | 来源章节 |
|------|---------|---------|
| **补码运算** | 定义、性质、溢出判断 | A2 |
| **Cache映射** | 直接/组相联/全相联 | A5 |
| **流水线冒险** | 结构/数据/控制三大冒险 | A4 |
| **性能计算** | 执行时间、MIPS、加速比 | A1 |
| **有效地址** | 各种寻址方式的EA计算 | A3 |

### 重要内容（⭐⭐）

| 考点 | 关键内容 | 来源章节 |
|------|---------|---------|
| **浮点数** | IEEE754、规格化、舍入 | A2 |
| **虚拟存储** | 页式存储、置换算法 | A5 |
| **分支预测** | 静态/动态/混合预测器 | A4 |
| **DMA** | 工作过程、与Cache冲突 | A6 |
| **中断系统** | 中断处理、优先级、嵌套 | A6 |

### 现代处理器技术（⭐）

| 考点 | 关键内容 | 来源章节 |
|------|---------|---------|
| **Cache一致性** | MESI协议、写失效/写更新 | A5 |
| **乱序执行** | 指令窗口、重排序缓冲 | A4 |
| **多核架构** | 共享Cache、互连网络 | A5 |

---

## 📊 学习建议

### 1. 复习顺序
```
A1 → A2 → A3 → A4 → A5 → A6 → A7
↓
概念理解 → 公式掌握 → 高频考题 → 综合应用
```

### 2. 重点突破
- **第一遍**：掌握基本概念和公式
- **第二遍**：做高频考题，理解解题思路
- **第三遍**：综合应用，画图表分析

### 3. 易错点提醒
- ❌ 混淆CPI和执行时间的单位
- ❌ 忘记Amdahl定律中的串行部分限制
- ❌ Cache映射方式的地址划分错误
- ❌ 流水线冒险的解决方案选择不当
- ❌ DMA与Cache的一致性问题

---

## 🔗 与30篇详细笔记的对应关系

| 七章精简版 | 对应30篇详细笔记 |
|-----------|-----------------|
| A1 | 01、29、30 |
| A2 | 02、03、04、05、06、07、08 |
| A3 | 09、10、11、12 |
| A4 | 13、14、15、16、17 |
| A5 | 18、19、20、21 |
| A6 | 22、23、24、25 |
| A7 | 26、27、28 |

---

## 💡 使用建议

1. **快速复习**：使用七章精简版 + 本补充说明
2. **深入学习**：查阅对应的30篇详细笔记
3. **考前冲刺**：重点复习高频考题示例和易错点
4. **综合应用**：结合多章知识解决综合题

---

**最后更新**：2025年1月  
**版本**：v1.0 补充版

