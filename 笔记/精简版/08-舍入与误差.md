# 08-舍入与误差

> 四种舍入模式、截断误差、精度损失  
> 最后更新：2025年1月

---

## 📑 目录

- [一、什么是舍入？](#一什么是舍入)
- [二、四种舍入模式](#二四种舍入模式)
- [三、截断误差](#三截断误差)
- [四、精度损失](#四精度损失)
- [五、总结](#五总结)

---

## 一、什么是舍入？

### 定义

**定义：** 舍入机制是计算机处理多余精度的4种策略，当数值无法精确表示时，需要决定如何舍入。

**通俗理解：** 舍入机制就像"处理零钱"，计算机处理多余精度的4种策略，就像处理0.5元该给1元还是不给。

### 为什么需要舍入？

```
原因：
  • 浮点数精度有限
  • 无法精确表示所有实数
  • 必须决定如何舍入

示例：
  1/3 = 0.3333...（无限循环）
  计算机只能存储有限位
  必须决定如何舍入
```

---

## 二、四种舍入模式

### 1. 就近舍入（Round to Nearest）⭐最常用

**通俗理解：** 就像"四舍五入"，选择最接近的值，等距离时取偶数避免累积误差。

```
规则：
  • 选择最接近的值
  • 等距离时取偶数（避免累积误差）

示例：
  2.4 → 2    (距离2更近)
  2.6 → 3    (距离3更近)
  2.5 → 2    (等距离时取偶数)
  3.5 → 4    (等距离时取偶数)

IEEE 754默认模式
```

### 2. 向零舍入（Round toward Zero）

**通俗理解：** 就像"截断"，总是砍掉小数部分。

```
规则：
  • 总是砍掉小数部分
  • 正数向下，负数向上

示例：
   2.9 →  2  (正数向下)
  -2.9 → -2  (负数向上)

应用：
  • 整数除法
  • 截断操作
```

### 3. 向上舍入（Round toward +∞）

**通俗理解：** 就像"天花板"，总是向正无穷方向。

```
规则：
  • 总是向+∞方向
  • 正数进位，负数也向上

示例：
   2.1 →  3  (正数进位)
  -2.9 → -2  (负数也向上)

应用：
  • 上界计算
  • 资源分配
```

### 4. 向下舍入（Round toward -∞）

**通俗理解：** 就像"地板"，总是向负无穷方向。

```
规则：
  • 总是向-∞方向
  • 正数舍弃，负数退位

示例：
   2.9 →  2  (正数舍弃)
  -2.1 → -3  (负数退位)

应用：
  • 下界计算
  • 安全计算
```

### 四种模式对比

| 模式 | 规则 | 示例(2.5) | 示例(-2.5) | 应用 |
|------|------|-----------|-----------|------|
| **就近** | 最接近，等距取偶 | 2 | -2 | 默认 |
| **向零** | 截断 | 2 | -2 | 整数除法 |
| **向上** | 向+∞ | 3 | -2 | 上界 |
| **向下** | 向-∞ | 2 | -3 | 下界 |

---

## 三、截断误差

### 什么是截断误差？

**通俗理解：** 截断误差就像"砍掉尾巴"，因为精度有限，必须截断，导致误差。

```
截断误差 = 真实值 - 表示值

示例：
  真实值：1/3 = 0.3333...
  表示值：0.333（3位小数）
  截断误差：0.0003...

原因：
  • 精度有限
  • 必须截断
  • 无法精确表示
```

### 误差累积

```
问题：
  • 多次运算累积误差
  • 误差可能放大

示例：
  0.1 + 0.2 = 0.30000000000000004
  （二进制无法精确表示0.1和0.2）

避免方法：
  • 使用足够精度
  • 避免重复舍入
  • 使用整数运算
```

---

## 四、精度损失

### 什么是精度损失？

**通俗理解：** 精度损失就像"信息丢失"，因为精度有限，某些信息丢失了。

```
精度损失场景：
  1. 大数 + 小数
     • 大数精度高，小数精度低
     • 小数可能被忽略
  
  2. 相近数相减
     • 有效数字减少
     • 精度大幅下降
  
  3. 连续运算
     • 每次舍入累积误差
     • 精度逐步下降
```

### 精度损失示例

**示例1：大数+小数**

```
问题：
  1000000.0 + 0.000001 = ?
  
  单精度浮点数：
    1000000.0（精度：1）
    + 0.000001（精度：0.000001）
    = 1000000.0（小数被忽略！）

原因：
  • 精度有限
  • 小数精度低于大数精度
  • 小数被忽略
```

**示例2：相近数相减**

```
问题：
  1.000001 - 1.000000 = ?
  
  单精度浮点数：
    1.000001 - 1.000000 = 0.000001
    但有效数字从7位降到1位！

原因：
  • 有效数字减少
  • 精度大幅下降
  • 可能导致错误结果
```

---

## 五、总结

### 核心要点

```
✅ 四种舍入模式：就近、向零、向上、向下
✅ 就近舍入最常用（IEEE 754默认）
✅ 截断误差：真实值 - 表示值
✅ 精度损失：大数+小数、相近数相减、连续运算
✅ 避免方法：足够精度、避免重复舍入、使用整数运算
```

### 关键理解

- **舍入**：处理多余精度的4种策略
- **就近舍入**：最常用，等距取偶避免累积误差
- **截断误差**：因精度有限导致的误差
- **精度损失**：大数+小数、相近数相减、连续运算
- **避免方法**：使用足够精度，避免重复舍入

### 实际应用

```
编程建议：
  • 使用双精度（double）而非单精度（float）
  • 避免大数+小数
  • 避免相近数相减
  • 使用整数运算（如用分而非元）
  • 注意舍入模式的选择
```

---

**最后更新：** 2025年1月





