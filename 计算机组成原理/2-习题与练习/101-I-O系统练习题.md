# I/O系统练习题

> 输入/输出系统练习题  
> 题量: 15 满分: 100  
> 作答时间：11-03 19:49至11月22日 19:50  
> 最后更新：2025年1月

---

## 一. 单选题（共13题，75分）

### 1. （单选题，6分）

**题目：** “当CPU向I/O模块发出命令时，它必须等待I/O操作完成”。这是程序控制的I/O，“等待”一词的意思是______。

**选项：**

A. CPU停止运行，什么也不做。

B. CPU 会执行其他操作。

C. CPU会定期读取并检查I/O模块的状态

D. CPU等待中断请求信号

**答案：C**

**解析：** 
- 程序控制的I/O（轮询方式）中，CPU不会停止运行，而是会**定期读取并检查I/O模块的状态寄存器**，直到I/O操作完成。
- A错误：CPU不会停止运行，而是继续执行轮询循环。
- B错误：如果CPU执行其他操作，就无法等待I/O操作完成。
- C正确：CPU通过循环读取状态寄存器来检查I/O操作是否完成。
- D错误：这是中断驱动I/O的特点，不是程序控制I/O。

---

### 2. （单选题，6分）

**题目：** 在DMA中，DMA模块接管了从CPU传输数据的操作，这意味着___________

**选项：**

A. DMA模块可以像CPU一样获取和执行指令。

B. DMA模块可以利用窃取周期技术控制总线，从而实现与内存之间的数据传输。

C. DMA模块和CPU协同工作，将数据传输到内存或从内存传输数据。

D. 当DMA模块准备就绪时，它会向CPU发出中断请求信号以获取中断服务。

**答案：B**

**解析：**
- DMA（Direct Memory Access）的核心特点是DMA控制器**直接控制总线**进行数据传输，无需CPU参与。
- A错误：DMA模块不能执行指令，它只是硬件控制器。
- B正确：DMA通过**窃取周期技术**（cycle stealing）或**块传输模式**控制总线，直接在内存和I/O设备之间传输数据。
- C错误：虽然DMA和CPU可能协同，但"DMA接管"强调的是DMA独立控制总线。
- D错误：DMA发出中断是在传输完成后通知CPU，不是在准备就绪时。

---

### 3. （单选题，6分）

**题目：** 使用I/O模块传输数据，可以使用3种技术。哪一种不属于这3种技术？

**选项：**

A. 中断驱动的 I/O 

B. 程序控制输入/输出

C. 直接 I/O 访问

D. DMA

**答案：C**

**解析：**
- 使用I/O模块传输数据的三种主要技术是：
  1. **程序控制I/O**（轮询方式）
  2. **中断驱动I/O**
  3. **DMA**（直接内存访问）
- "直接I/O访问"不是这三种技术之一，它指的是CPU直接访问I/O设备而不通过I/O模块，这不是标准的三类I/O技术。

---

### 4. （单选题，6分）

**题目：** 在内存映射 I/O 方法中，主内存和 I/O 设备的地址通过________来区分。

**选项：**

A. 单个地址空间内的不同地址范围

B. 不同的地址线

C. 不同的控制线

D. 不同的数据线

**答案：A**

**解析：**
- **内存映射I/O**的特点是将I/O设备和主内存放在**同一个地址空间**中，通过**不同的地址范围**来区分它们。
- 例如：地址0x0000-0x7FFF分配给内存，0x8000-0xFFFF分配给I/O设备。
- B、C、D错误：内存映射I/O使用相同的地址线、控制线和数据线，只是地址范围不同。

---

### 5. （单选题，6分）

**题目：** 以下哪些是 I/O 模块中的寄存器？ 

I. 指令寄存器  
II. 控制寄存器  
III. 状态寄存器  
IV. 内存地址寄存器  
V. 数据缓冲寄存器

**选项：**

A. I、II、III

B. II、III、IV

C. II、III、V

D. II、III、IV、V

**答案：C**

**解析：**
- I/O模块中的寄存器主要包括：
  - **控制寄存器**（II）：用于设置I/O模块的工作模式
  - **状态寄存器**（III）：用于存储I/O设备的状态信息
  - **数据缓冲寄存器**（V）：用于暂存传输的数据
- I错误：指令寄存器是CPU中的寄存器，不是I/O模块的。
- IV错误：内存地址寄存器通常只在DMA控制器中存在，不是所有I/O模块都有。

---

### 6. （单选题，6分）

**题目：** 使用中断驱动 I/O 时，I/O 模块和 I/O 设备之间交换的信息不包括_______。

**选项：**

A. 数据信息

B. 控制信息

C. 状态信息

D. 中断请求信号

**答案：D**

**解析：**
- 在中断驱动I/O中，I/O模块和I/O设备之间交换的信息包括：
  - **数据信息**（A）：传输的数据
  - **控制信息**（B）：控制命令
  - **状态信息**（C）：设备状态
- **中断请求信号**（D）是I/O模块**向CPU发送**的信号，用于通知CPU有I/O操作需要处理，这不是I/O模块和设备之间交换的信息。

---

### 7. （单选题，6分）

**题目：** 设置中断优先级仲裁逻辑的目的是________。

**选项：**

A. 生成中断号

B. 确保在所有同时发生的中断请求中，优先级最高的请求能够及时得到响应。

C. 允许 CPU 分支中断服务例程

D. 为了提高中断响应速度

**答案：B**

**解析：**
- 中断优先级仲裁逻辑的核心作用是：当**多个中断同时发生**时，确保**优先级最高的中断请求能够及时得到响应**。
- A错误：生成中断号不是仲裁逻辑的主要目的。
- B正确：这是中断优先级仲裁的核心功能。
- C错误：分支到中断服务例程是CPU根据中断号执行的，不是仲裁逻辑的目的。
- D错误：虽然可能提高响应速度，但不是设置仲裁逻辑的主要目的。

---

### 8. （单选题，6分）

**题目：** 使用堆栈保存PC和余数，原因是______

**选项：**

A. 一些用于在中断点恢复当前程序的信息

B. 发生中断时，指令不会直接执行完毕，因此中断点处的指令必须再次执行。

C. 堆栈必须获取一些用于后进先出 (LIFO) 的信息。

D. ISR 的起始地址必须通过堆栈传输。

**答案：A**

**解析：**
- 使用堆栈保存PC（程序计数器）和寄存器状态的原因是：**保存中断点处的现场信息，以便中断处理完成后能够恢复原程序的执行**。
- A正确：这是保存现场的根本目的。
- B错误：中断发生时，当前指令通常已经执行完毕，不需要再次执行。
- C错误：LIFO特性是堆栈的特性，但不是保存PC的原因。
- D错误：ISR的起始地址通常通过中断向量表获取，不是通过堆栈。

---

### 9. （单选题，6分）

**题目：** 与中断驱动的I/O相比，DMA进一步提高了CPU操作的使用率，因为_________

**选项：**

A. CPU 不需要保存和恢复场景  

B. CPU无需干预数据传输。

C. CPU无需反复读取和检查状态。

D. A 和 B 都成立

**答案：D**

**解析：**
- 与中断驱动I/O相比，DMA的优势：
  - **A正确**：DMA传输完成后才发中断，CPU不需要频繁保存和恢复现场。
  - **B正确**：DMA控制器直接控制总线传输数据，CPU无需干预传输过程。
  - C虽然也正确，但不是DMA相比中断驱动I/O的独特优势（中断驱动I/O也不需要反复读取状态）。
- 因此D正确：A和B都是DMA提高CPU利用率的原因。

---

### 10. （单选题，6分）

**题目：** 在DMA过程中，DMA模块何时向CPU发出中断请求信号？

**选项：**

A. 在DMA模块传输数据块之前

B. DMA模块完成块数据传输后

C. 在DMA模块停止使用总线之前

D. DMA模块结束后占用总线

**答案：B**

**解析：**
- DMA工作流程：
  1. CPU初始化DMA
  2. DMA请求总线，开始传输
  3. DMA传输数据块
  4. **DMA完成传输后，向CPU发送中断信号通知传输完成**
- B正确：DMA在完成块数据传输后发中断。
- A错误：传输前不需要发中断。
- C、D错误：描述不准确。

---

### 11. （单选题，5分）

**题目：** 使用I/O模块传输数据时，可以使用三种技术。哪种技术不需要CPU干预数据传输？

**选项：**

A. 中断驱动的 I/O

B. 程序控制输入/输出

C. 直接 I/O 访问

D. DMA

**答案：D**

**解析：**
- 在这三种I/O技术中，只有**DMA**不需要CPU干预数据传输过程。
  - 程序控制I/O：CPU需要轮询检查状态
  - 中断驱动I/O：CPU需要执行中断服务例程传输数据
  - **DMA**：CPU只需初始化，传输过程由DMA控制器独立完成

---

### 12. （单选题，5分）

**题目：** 下列哪些信息是通过数据总线传输的？

I. 命令词  
II. 状态  
III. 中断号

**选项：**

A. 仅 I 和 II

B. 仅 I 和 III

C. 仅 II 和 III

D. I、II 和 III

**答案：D**

**解析：**
- 在计算机系统中，**命令词、状态信息、中断号**都可以通过数据总线传输。
- 命令词：CPU通过数据总线向I/O模块发送控制命令
- 状态：I/O模块通过数据总线向CPU返回状态信息
- 中断号：中断控制器通过数据总线向CPU提供中断向量号

---

### 13. （单选题，5分）

**题目：** 下列关于I/O技术的陈述哪一项是错误的？

**选项：**

A. 在程序控制的 I/O 中，I/O 操作由 CPU 执行轮询程序来完成。

B. 在中断 I/O 中，I/O 操作由 CPU 执行中断服务例程来执行。

C. 在 DMA 中，I/O 操作由 CPU 执行 DMA 传输程序来完成。

D. 对于 SSD 等高速设备，DMA 用于输入/输出。

**答案：C**

**解析：**
- A正确：程序控制I/O中，CPU执行轮询程序检查I/O状态。
- B正确：中断I/O中，CPU执行中断服务例程（ISR）来处理I/O操作。
- **C错误**：在DMA中，I/O操作由**DMA控制器**直接完成，CPU只负责初始化DMA，不执行DMA传输程序。
- D正确：高速设备如SSD使用DMA进行数据传输。

---

## 二. 简答题（共2题，25分）

### 14. （简答题，15分）

**题目：** 一台机器有 5 个中断源（1、2、3、4、5），硬件固有优先级为 1>2>3>4>5。现在希望通过软件掩码重新排出响应顺序 **4>3>5>1>2**。请：

1. 写出与每个中断源对应的掩码字（位序统一为 1→2→3→4→5，1 表示屏蔽，0 表示允许）。
2. 按下图给出的触发时间（单位 µs：I2@5、I4@10、I3@30、I5@50、I1@70）画出 CPU 执行主程序与各 ISR 的时间轴，假设每个 ISR 执行 15 µs。

> 时间轴（题目给定）
> 
> 程序轴上依次在 5、10、30、50、70 µs 处分别有中断源 2、4、3、5、1 的触发标记。

---

### 15. （简答题，10分）

**题目：** 

（1）在中断处理过程中，CPU何时可以向请求中断的I/O模块发送确认信号？

（2）CPU会将当前程序的信息保存到堆栈中以便恢复执行。哪些信息是重要的？

---

## 答题区域

### 一. 单选题（75分）

| 题号 | 答案 | 题号 | 答案 | 题号 | 答案 |
|------|------|------|------|------|------|
| 1    | C    | 6    | D    | 11   | D    |
| 2    | B    | 7    | B    | 12   | D    |
| 3    | C    | 8    | A    | 13   | C    |
| 4    | A    | 9    | D    |      |      |
| 5    | C    | 10   | B    |      |      |

### 二. 简答题（25分）

**14. 答案：**

**（1）掩码字设计与处理顺序**

| 中断源 | 目标顺序 | 掩码字（1→2→3→4→5） | 说明 |
|--------|----------|-----------------------|------|
| 4      | 第 1 个   | `1 1 1 0 0`           | 仅放行 4、5，保证 4 最先被响应 |
| 3      | 第 2 个   | `1 1 0 1 1`           | 进入 ISR4 后切换到此掩码，仅允许 3 |
| 5      | 第 3 个   | `1 1 1 1 0`           | ISR3 退出时装载，只允许 5 |
| 1      | 第 4 个   | `0 1 1 1 1`           | ISR5 退出后放行 1 |
| 2      | 第 5 个   | `1 0 1 1 1`           | ISR1 退出后放行 2，完成所需顺序 |

掩码字中的 1 表示屏蔽该中断源，0 表示允许。通过在各 ISR 的入口/出口装载对应掩码，可在硬件固定顺序 1>2>3>4>5 的基础上实现目标顺序 4→3→5→1→2。

**（2）时间轴（单位 µs）**

| 时间区段 | CPU 执行内容 | 说明 |
|----------|--------------|------|
| 0–10     | 主程序       | I4 于 10 µs 请求，但需等主程序当前指令结束 |
| 10–25    | ISR4         | 立即响应 4，并装载 `1 1 0 1 1`，只允许 3 |
| 25–40    | ISR3         | I3 在 30 µs 请求，因掩码允许而紧接执行 |
| 40–55    | ISR5         | ISR3 退出改用 `1 1 1 1 0`，I5 在 50 µs 触发后立刻获响应 |
| 55–70    | ISR1         | ISR5 退出改用 `0 1 1 1 1`，等待 I1（70 µs）触发后进入 |
| 70–85    | ISR2         | 最后装载 `1 0 1 1 1`，I2 虽 5 µs 时提出但一直被屏蔽，此时得到处理 |
| 85+      | 主程序       | 所有 ISR 结束，恢复默认掩码继续执行 |

每个 ISR 长度 15 µs，整体轨迹呈现“主程序 → 4 → 3 → 5 → 1 → 2 → 主程序”的流水，与题目给定的触发时间完全匹配。

---

**15. 答案：**

**（1）确认信号发送时机：**

CPU可以在以下时机向请求中断的I/O模块发送确认信号：

1. **中断响应周期**：CPU检测到中断请求后，在中断响应周期（INTA周期）发送确认信号，通知I/O模块CPU已接受中断请求。

2. **中断识别后**：CPU读取中断向量号或中断号后，可以发送确认信号，表示已识别该中断源。

3. **中断服务例程开始执行前**：在执行ISR之前，CPU发送确认信号，通知I/O模块中断已被处理。

**典型时序：**
```
中断请求信号(IRQ) → CPU检测中断 → 发送INTA信号 → 
I/O模块返回中断号 → CPU跳转到ISR → 执行ISR → 清除中断标志
```

**（2）需要保存的重要信息：**

CPU在中断处理时需要保存以下重要信息到堆栈：

1. **程序计数器（PC）**：
   - 保存中断点的指令地址
   - 用于中断返回后继续执行原程序

2. **处理器状态字（PSW）或标志寄存器**：
   - 保存条件码（CF、ZF、OF等）
   - 保存中断允许标志
   - 保存处理器模式等状态信息

3. **通用寄存器**：
   - 保存所有或部分通用寄存器的值
   - 确保ISR执行后能恢复原程序的寄存器状态

4. **中断屏蔽字或中断优先级**：
   - 保存当前的中断屏蔽状态
   - 用于嵌套中断时恢复原优先级

5. **其他处理器状态**：
   - 浮点寄存器状态（如果使用）
   - 特殊寄存器状态

**保存顺序（典型）：**
```
进入中断时：
  1. 将PC压入堆栈
  2. 将PSW压入堆栈
  3. 将通用寄存器压入堆栈
  
退出中断时（恢复顺序相反）：
  1. 从堆栈恢复通用寄存器
  2. 从堆栈恢复PSW
  3. 从堆栈恢复PC（IRET指令）
```

---

## 笔记区域

### 知识点总结

#### 1. I/O传输方式对比

| 方式 | CPU参与程度 | 效率 | 适用场景 |
|------|------------|------|----------|
| 程序控制I/O | 完全参与（轮询） | 低 | 简单、低速设备 |
| 中断驱动I/O | 部分参与（ISR） | 中 | 中速设备 |
| DMA | 仅初始化 | 高 | 高速设备（硬盘、网卡） |

#### 2. 内存映射I/O vs 独立I/O

**内存映射I/O：**
- 主存和I/O在同一地址空间
- 通过地址范围区分
- 使用相同的地址线、控制线、数据线

**独立I/O（I/O映射）：**
- 主存和I/O有独立地址空间
- 通过不同的控制线区分（如MEMR/MEMW vs IOR/IOW）

#### 3. I/O模块寄存器

- **控制寄存器**：设置I/O模块工作模式
- **状态寄存器**：存储设备状态（就绪、忙、错误等）
- **数据缓冲寄存器**：暂存传输的数据

#### 4. DMA工作原理

**DMA传输流程：**
1. CPU初始化DMA（设置源地址、目的地址、字节数）
2. DMA请求总线（BR信号）
3. CPU响应，释放总线（BG信号）
4. DMA直接传输数据
5. DMA完成，发中断通知CPU

**DMA提高效率的原因：**
- CPU无需参与数据传输过程
- CPU无需频繁保存/恢复现场
- 适合批量数据传输

#### 5. 中断处理

**中断响应过程：**
1. 检测中断请求
2. 保存现场（PC、PSW、寄存器）
3. 关闭中断（可选）
4. 执行ISR
5. 恢复现场
6. 开中断（可选）
7. 返回原程序

**中断优先级：**
- 硬件优先级：硬件固定的优先级顺序
- 软件优先级：通过中断屏蔽字动态调整

### 易错点提醒

1. **程序控制I/O的"等待"**：不是CPU停止运行，而是CPU循环检查状态寄存器。

2. **DMA模块功能**：DMA不能执行指令，它只是硬件控制器，通过控制总线传输数据。

3. **I/O模块寄存器**：指令寄存器是CPU的，不是I/O模块的。内存地址寄存器只在DMA控制器中存在。

4. **中断请求信号方向**：中断请求信号是I/O模块向CPU发送的，不是I/O模块和设备之间交换的。

5. **DMA中的I/O操作**：DMA传输由DMA控制器完成，CPU只负责初始化，不执行传输程序。

6. **中断掩码字理解**：
   - 1 = 屏蔽该中断
   - 0 = 允许该中断
   - 需要结合硬件优先级分析处理顺序

### 相关概念回顾

#### 中断掩码字

**定义：** 中断服务程序中设置的屏蔽字，用于控制哪些中断可以在当前中断处理期间被响应。

**作用：**
- 实现软件优先级控制
- 防止中断嵌套或允许特定中断嵌套
- 保护关键代码段

**示例分析：**
- 掩码字 1 1 0 1：屏蔽中断1、2、4，允许中断3
- 掩码字 0 1 0 0：屏蔽中断2，允许中断1、3、4
- 掩码字 1 1 1 1：屏蔽所有中断（不可嵌套）

#### 中断优先级仲裁

**硬件判优：**
- 固定优先级：1 > 2 > 3 > 4
- 同时请求时，选择优先级最高的

**软件判优：**
- 通过中断屏蔽字动态调整
- 允许低优先级中断在高优先级中断处理期间被响应

---

**文件信息：**  
- 创建时间：2025年1月  
- 题目来源：I/O系统练习题  
- 关联笔记：084-I-O接口和编址方式.md, 085-DMA技术详解.md, 086-中断系统详解.md
