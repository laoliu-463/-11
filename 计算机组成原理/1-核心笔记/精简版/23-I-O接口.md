# 23-IO接口：CPU的外交官

> **核心视角**：I/O 接口是 CPU（高速、数字、同步）与外部设备（低速、模拟/数字、异步）之间的**适配器**。它负责将外部世界的**杂乱信号**转换为 CPU 能理解的**规范状态**。
> 最后更新：2025年1月

---

## 一、为什么需要接口？

CPU 不能直接连到打印机或键盘上，因为：
1.  **速度不匹配**：CPU 纳秒级，硬盘毫秒级，键盘秒级。
2.  **信号不匹配**：CPU 是 TTL 电平，网线是差分信号，声卡是模拟信号。
3.  **格式不匹配**：CPU 处理二进制字，外设可能处理字符或数据流。

**I/O 接口的功能**：
*   **缓冲**：暂存数据，平滑速度差异（数据寄存器）。
*   **转换**：串并转换、模数转换。
*   **控制**：接收 CPU 命令，监控设备状态（状态/控制寄存器）。

---

## 二、编址方式：如何找到外设？

CPU 如何向接口发送命令？

### 1. 统一编址 (Memory Mapped I/O)
*   **原理**：将 I/O 接口的寄存器映射到**内存地址空间**的一部分。
*   **操作**：CPU 使用普通的 `LOAD/STORE` 指令访问外设。
    *   `STORE R1, 0xFFFF0004` 可能是在向串口发送数据。
*   **优点**：指令集简单，无需专用指令。RISC 架构（ARM, MIPS）常用。

### 2. 独立编址 (Port Mapped I/O)
*   **原理**：I/O 接口拥有独立的**端口地址空间**。
*   **操作**：CPU 使用专用的 `IN/OUT` 指令。
    *   `OUT 0x60, AL`
*   **优点**：不占用内存地址空间，程序清晰。x86 架构常用。

---

## 三、数据传送控制：谁来主导？

### 1. 程序查询 (Polling)：CPU 轮询
*   **方式**：CPU 不断读取状态寄存器，问："好了吗？好了吗？"
*   **评价**：CPU 沦为保姆，效率极低。

### 2. 中断 (Interrupt)：设备主动
*   **方式**：CPU 专心干活。设备好了发中断信号。CPU 暂停当前工作去处理。
*   **评价**：CPU 解放了，适合低速、低频设备（键盘、鼠标）。

### 3. DMA (Direct Memory Access)：外包
*   **方式**：CPU 授权给 DMA 控制器。DMA 直接在内存和外设间搬运数据。
*   **评价**：适合高速、大数据量设备（硬盘、显卡）。

---

## 四、总结

*   I/O 接口是 CPU 的**外交官**。
*   它通过**寄存器**（数据、状态、控制）向 CPU 暴露了一个标准化的操作界面。
*   CPU 可以像读写内存一样读写这些寄存器，从而控制复杂的外部设备。

---

## 核心考点与习题映射 (Exam Focus)
> **来源**：`101-I-O系统练习题`, `104-期末综合练习题`

### 1. I/O 控制方式
*   **程序查询 (Polling)**：CPU 忙等，效率低。
*   **中断驱动 (Interrupt)**：
    *   CPU 与外设并行。
    *   I/O 完成时发 **INTR** 信号。
    *   **响应时机 (101-Q15)**：指令执行周期结束。
*   **DMA (直接存储器访问) (101-Q2, Q9, Q11)**：
    *   **特点**：硬件接管总线，CPU 不干预数据传输。
    *   **效率**：仅在开始/结束时中断 CPU (块传输)。
    *   **优先级**：DMA > 中断。
