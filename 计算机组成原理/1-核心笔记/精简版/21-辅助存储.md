# 21-辅助存储

> 磁盘结构、磁盘调度算法、RAID技术  
> 最后更新：2025年1月

---

## 📑 目录

- [一、磁盘结构](#一磁盘结构)
- [二、磁盘访问时间](#二磁盘访问时间)
- [三、磁盘调度算法](#三磁盘调度算法)
- [四、RAID技术](#四raid技术)
- [五、总结](#五总结)

---

## 一、磁盘结构

### 基本概念

**通俗理解：** 磁盘结构就像"多层同心圆盘"，磁道是同心圆，扇区是每圈上的扇形区域，柱面是所有盘面上相同半径的磁道集合。

```
磁盘结构：
  • 磁道（Track）：磁盘上的同心圆
  • 扇区（Sector）：磁道上的扇形区域，最小存储单位
  • 柱面（Cylinder）：所有盘面上相同半径的磁道集合

地址：
  柱面号 + 磁头号 + 扇区号
  （Cylinder, Head, Sector）

示例：
  请求序列：
    (50, 0, 1)  - 柱面50，磁头0，扇区1
    (100, 0, 1) - 柱面100，磁头0，扇区1
    (30, 0, 1)  - 柱面30，磁头0，扇区1
```

### 磁盘结构图示

```
磁盘结构：
┌─────────────────────────────────────┐
│        磁盘（多个盘片）               │
│                                     │
│  柱面0 柱面1 柱面2 ... 柱面N       │
│    │     │     │          │        │
│    └─────┴─────┴──────────┘        │
│        同一柱面                      │
│                                     │
│  磁道：同心圆                        │
│  扇区：扇形区域                      │
└─────────────────────────────────────┘
```

---

## 二、磁盘访问时间

### 三个组成部分

**通俗理解：** 磁盘访问时间就像"找书的时间"，包括走到书架（寻道）、找到书的位置（旋转延迟）、拿书（传输）。

```
磁盘访问时间 = 寻道时间 + 旋转延迟 + 传输时间

1. 寻道时间（最长）
   • 磁头移动到目标磁道的时间
   • 典型：5-15ms
   • 主要优化目标

2. 旋转延迟
   • 磁盘旋转到目标扇区的时间
   • 平均：旋转半圈的时间
   • 典型：4-8ms

3. 传输时间（最短）
   • 读取/写入数据的时间
   • 典型：<1ms
```

### 访问时间计算

```
示例：
  磁盘转速：7200 RPM
  寻道时间：10ms
  传输数据：1KB

计算：
  旋转延迟 = 60s / 7200 / 2 = 4.17ms
  传输时间 = 1KB / 100MB/s = 0.01ms
  
  总时间 = 10 + 4.17 + 0.01 = 14.18ms

优化重点：
  • 最小化寻道时间（主要优化目标）
  • 磁盘调度算法
```

---

## 三、磁盘调度算法

### 为什么需要调度？

**通俗理解：** 磁盘调度就像"电梯调度"，多个楼层有请求（多个磁盘请求），电梯需要决定先去哪层（磁盘调度），好的调度可以减少总时间（减少寻道时间）。

### 1. FCFS（先来先服务）

**通俗理解：** 就像"排队"，谁先来谁先服务，简单公平但效率低。

```
原理：
  按请求到达顺序服务

示例：
  请求序列：50, 100, 30, 80
  当前位置：40
  
  访问顺序：50 → 100 → 30 → 80
  总寻道距离：10 + 50 + 70 + 50 = 180

优点：
  ✓ 简单公平

缺点：
  ✗ 效率低（可能来回移动）
```

### 2. SSTF（最短寻道时间优先）

**通俗理解：** 就像"就近服务"，总是选择最近的请求，效率高但可能饥饿。

```
原理：
  总是选择距离当前位置最近的请求

示例：
  请求序列：50, 100, 30, 80
  当前位置：40
  
  访问顺序：50 → 30 → 80 → 100
  总寻道距离：10 + 20 + 50 + 20 = 100

优点：
  ✓ 效率高

缺点：
  ✗ 可能饥饿（边缘请求可能永远不服务）
```

### 3. SCAN（电梯算法）⭐常用

**通俗理解：** 就像"电梯"，从一端扫到另一端，然后反向。

```
原理：
  从一端扫到另一端，然后反向

示例：
  请求序列：50, 100, 30, 80
  当前位置：40，方向：向右
  
  访问顺序：50 → 80 → 100 → 30
  总寻道距离：10 + 30 + 20 + 70 = 130

优点：
  ✓ 效率较高
  ✓ 无饥饿问题

缺点：
  ✗ 边缘请求等待时间长
```

### 4. C-SCAN（循环扫描）

**通俗理解：** 就像"单向电梯"，只在一个方向扫描，到另一端后快速返回。

```
原理：
  只在一个方向扫描，到另一端后快速返回

示例：
  请求序列：50, 100, 30, 80
  当前位置：40，方向：向右
  
  访问顺序：50 → 80 → 100 → 30
  （100后快速返回0，再到30）

优点：
  ✓ 等待时间更均匀

缺点：
  ✗ 返回时间浪费
```

### 算法对比

| 算法 | 原理 | 优点 | 缺点 | 寻道距离 |
|------|------|------|------|---------|
| **FCFS** | 先来先服务 | 简单公平 | 效率低 | 高 |
| **SSTF** | 最短寻道优先 | 效率高 | 可能饥饿 | 中 |
| **SCAN** | 电梯算法 | 效率高，无饥饿 | 边缘等待长 | 中低 |
| **C-SCAN** | 循环扫描 | 等待均匀 | 返回浪费 | 中低 |

---

## 四、RAID技术

### 什么是RAID？

**定义：** RAID（Redundant Array of Independent Disks，独立磁盘冗余阵列）是将多个磁盘组合成一个逻辑单元，提供数据冗余和性能提升的技术。

**通俗理解：** RAID就像"多本书备份"，把数据分散到多个磁盘，既提高速度又保证安全。

### RAID级别

```
RAID 0（条带化）：
  • 数据分散到多个磁盘
  • 无冗余，速度快
  • 一个磁盘故障，全部丢失

RAID 1（镜像）：
  • 数据完全复制到两个磁盘
  • 冗余高，速度中等
  • 一个磁盘故障，数据不丢失

RAID 5（分布式奇偶校验）：
  • 数据和校验信息分散
  • 冗余和性能平衡
  • 允许一个磁盘故障

RAID 10（RAID 1+0）：
  • 先镜像，再条带化
  • 冗余和性能都高
  • 允许多个磁盘故障（不同组）
```

### RAID对比

| RAID级别 | 冗余 | 性能 | 容量利用率 | 容错 |
|---------|------|------|-----------|------|
| **RAID 0** | 无 | 最高 | 100% | 无 |
| **RAID 1** | 高 | 中等 | 50% | 1个磁盘 |
| **RAID 5** | 有 | 较高 | (n-1)/n | 1个磁盘 |
| **RAID 10** | 高 | 高 | 50% | 多个磁盘 |

---

## 五、总结

### 核心要点

```
✅ 磁盘结构：磁道、扇区、柱面
✅ 访问时间 = 寻道时间 + 旋转延迟 + 传输时间
✅ 磁盘调度：FCFS、SSTF、SCAN、C-SCAN
✅ SCAN算法最常用（电梯算法）
✅ RAID：数据冗余和性能提升
```

### 关键理解

- **磁盘结构**：磁道、扇区、柱面，地址用CHS表示
- **访问时间**：寻道时间最长，是主要优化目标
- **调度算法**：SCAN算法最常用，平衡效率和公平
- **RAID技术**：提供数据冗余和性能提升
- **优化方向**：最小化寻道时间，使用RAID提升性能

---

**最后更新：** 2025年1月

