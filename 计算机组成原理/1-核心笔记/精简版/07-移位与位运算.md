# 07-移位与位运算：比特级的精密手术

> **核心视角**：位运算 (Bitwise Operations) 是计算机最**原生**、最**高效**的状态变换方式。它直接对数据的最小单元（比特）进行操作，是所有高级运算（如乘除法、加密）的基石。
> 最后更新：2025年1月

---

## 一、移位运算：硬件级的乘除法

移位运算利用了二进制的特性，通过移动比特位来实现乘除法，速度比通用乘除法指令快得多。

### 1. 逻辑移位 (Logical Shift) —— 无符号数的乘除
*   **逻辑左移 (SHL)**：`x << n`。
    *   **操作**：整体左移，低位补 **0**。
    *   **功能**：$x \times 2^n$。
    *   **示例**：`0011 (3) << 1 = 0110 (6)`。
*   **逻辑右移 (SHR)**：`x >> n`。
    *   **操作**：整体右移，高位补 **0**。
    *   **功能**：$x / 2^n$（向下取整）。
    *   **示例**：`0110 (6) >> 1 = 0011 (3)`。

### 2. 算术移位 (Arithmetic Shift) —— 有符号数的乘除
*   **算术左移 (SAL)**：同逻辑左移。
    *   *注意*：如果移位导致符号位改变，说明发生**溢出**。
*   **算术右移 (SAR)**：`x >> n`。
    *   **操作**：整体右移，高位补**符号位**（即：正数补0，负数补1）。
    *   **功能**：$x / 2^n$（保持符号）。
    *   **关键点**：这是为了保证负数除以 2 仍然是负数。
    *   **示例**：`1111 1100 (-4) >> 1 = 1111 1110 (-2)`。如果补0就会变成正数，那就错了。

### 3. 循环移位 (Rotate) —— 数据的混淆与重排
*   **操作**：移出的位不丢弃，而是填补到空出的另一端。
*   **应用**：密码学（如 AES 加密）、哈希函数、大端小端转换。

---

## 二、位逻辑运算：状态的掩码与合成

位运算通常用于对状态进行精细控制，称为**掩码 (Masking)** 技术。

| 运算 | 符号 | 核心功能 | 状态视角 |
| :--- | :--- | :--- | :--- |
| **AND** | `&` | **提取/清零** | 只保留特定的位，其余清零（关灯）。 |
| **OR** | `\|` | **设置/合并** | 将特定的位强制设为 1（开灯）。 |
| **XOR** | `^` | **翻转/比较** | 翻转特定的位；或判断两数是否相等（相等为0）。 |
| **NOT** | `~` | **取反** | 0变1，1变0。 |

### 典型应用场景
1.  **提取低 8 位**：`x & 0xFF`。
2.  **将第 3 位置 1**：`x | (1 << 3)`。
3.  **将第 3 位置 0**：`x & ~(1 << 3)`。
4.  **翻转第 3 位**：`x ^ (1 << 3)`。
5.  **交换两个数（不借用临时变量）**：`a ^= b; b ^= a; a ^= b;`（利用 XOR 的可逆性）。

---

## 三、总结

*   **移位**是廉价的乘除法。
*   **位运算**是精确的状态手术刀。
*   掌握位运算，意味着你能够跳过高级语言的抽象，直接操纵计算机最底层的**开关状态**。
