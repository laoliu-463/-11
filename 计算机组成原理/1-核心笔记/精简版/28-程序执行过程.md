# 28-程序执行过程：从静态代码到动态生命

> **核心视角**：程序执行是一个**状态激活**的过程。
> **静态状态**（硬盘上的 EXE 文件） $\rightarrow$ **加载** $\rightarrow$ **动态状态**（内存中的进程镜像） $\rightarrow$ **执行** $\rightarrow$ **状态变换**（CPU 运行）。
> 最后更新：2025年1月

---

## 一、编译 (Compilation)：翻译官

将人类可读的**高级语言**（C/C++）翻译成机器可执行的**二进制指令**。

1.  **预处理**：文本替换。
2.  **编译**：生成汇编代码（`.s`）。
3.  **汇编**：生成机器码目标文件（`.o`）。
4.  **链接 (Linking)**：将多个 `.o` 文件和库文件（`.lib`）拼接在一起，解析符号引用，生成最终的可执行文件（`.exe` / ELF）。

## 二、加载 (Loading)：激活

程序在硬盘上只是死的数据。**加载器 (Loader)** 将其赋予生命。

1.  **分配内存**：操作系统为新进程创建虚拟地址空间。
2.  **映射段**：
    *   **代码段 (Text)**：只读，存放指令。
    *   **数据段 (Data)**：读写，存放全局变量。
    *   **BSS 段**：存放未初始化的全局变量（自动清零）。
3.  **初始化栈和堆**：设置 SP 指针。
4.  **跳转入口**：将 PC 指向 `_start`（通常是 C 运行时的入口，它会调用 `main`）。

## 三、执行 (Execution)：运转

CPU 接管控制权，开始**取指-译码-执行**的无限循环。

*   **取指**：从代码段读取指令。
*   **数据流**：在寄存器、栈、堆、数据段之间流动。
*   **控制流**：在函数之间跳转。

---

## 四、总结

*   计算机系统的运行，就是**静态数据**被加载到**内存**，然后在**CPU** 的驱动下不断演化**状态**的过程。
*   理解这个过程，你就理解了为什么会有 **Segmentation Fault**（访问了未映射的内存段），以及为什么全局变量有初值而局部变量是随机值（栈内存未清零）。
