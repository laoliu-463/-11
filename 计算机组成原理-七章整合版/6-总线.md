

# 第6章：总线与 I/O 系统

> 目标：快速掌握总线、I/O 接口、DMA 与中断的关键概念，并能据此定位到详细笔记。  
> 覆盖主题：22-总线系统、23-I/O接口、24-DMA技术、25-中断系统  
> 最后更新：2025 年 1 月

---

## 知识点简要介绍

1. **总线基础**  
   - 系统总线 = 地址总线（单向寻址） + 数据总线（双向传数） + 控制总线（指令时序）。  
   - 总线 = 共享介质 → 分时使用；性能由位宽 × 频率决定，常通过分离指令/数据或多层总线缓解冲突。

2. **总线事务与仲裁**  
   - 事务流程：申请→仲裁→传输→释放，读写操作有固定时序图。  
   - 仲裁方式：链式（简单但不公平）、计数器轮询（较公平）、独立请求（并行且可编程）。

3. **I/O 接口与编址方式**  
   - 接口由数据/状态/控制寄存器组成，用于缓冲与握手。  
   - 编址方式：独立 I/O（IN/OUT 指令） vs 统一编址（内存映射 I/O）。

4. **数据传送方式与 DMA**  
   - 程序查询 → CPU 全程轮询；程序中断 → 设备就绪时发中断；DMA → 设备直接与主存交换数据。  
   - DMA 工作：CPU 初始化 → DMA 请求总线 → 传输完成后中断通知；常见模式：字节、块、周期窃取、透明传输。

5. **中断系统**  
   - 中断类型：外部、内部、访管；响应流程 = 完成当前指令 → 保存现场 → 查向量 → ISR → 恢复现场。  
   - 关注优先级、嵌套与屏蔽字；区分程序查询 vs 中断、DMA 与 Cache 不一致的处理方式。

6. **高频易错点**  
   - 总线带宽计算、仲裁公平性、DMA 与 Cache 冲突（刷新/一致性协议）、中断现场保存顺序、统一编址/独立编址区别。

---

## 详细内容索引

| 主题 | 原文笔记 | 说明 |
|------|-----------|------|
| 总线概念、结构、事务、仲裁 | [[22-总线系统]] | 描述三大总线、读写时序、三种仲裁方式及性能指标 |
| I/O 接口组成、编址方式、数据传送对比 | [[23-I-O接口]] | 数据/状态/控制寄存器、独立/统一编址、查询/中断/DMA 特点 |
| DMA 工作机制、传输模式、与 CPU 协同 | [[24-DMA技术]] | DMA 控制器结构、流程、模式对比、性能分析示例 |
| 中断类型、响应流程、优先级与嵌套 | [[25-中断系统]] | 中断向量表、现场保存、嵌套控制、易错点总结 |

> 阅读顺序建议：先看 `22` 理解总线与仲裁，再结合 `23/24/25` 了解 I/O、DMA、中断如何协同运行，最后回到本章提要巩固要点。

---

**说明**：本章仅保留脉络速览与索引，图示/推导/例题仍在 `计算机组成原理/1-核心笔记/精简版/22~25`。待全部章节整理完毕后，会统一清理旧版 A6 内容。
└─────────────┘
```

### 2. I/O 编址方式
- **独立编址** (I/O-mapped)：I/O空间独立，使用特殊指令 (`IN/OUT`)
- **统一编址** (Memory-mapped)：I/O与内存统一编址，使用通用访存指令

---

## 三、数据传送方式

| 方式 | 特点 | 适用场景 |
|------|------|----------|
| 程序查询 | CPU轮询状态 | 低速设备、简单实现 |
| 程序中断 | 设备准备好后发中断，CPU响应 | 中速设备，减少轮询开销 |
| DMA | 设备直接访问主存 | 大批量高速数据传输 |

> 考试常比较“CPU占用率、硬件复杂度、吞吐率”

---

## 四、DMA 工作机制

### 1. DMA 过程
```
① CPU 初始化 DMA 控制器（源地址、目的地址、传输长度）
② DMA 请求总线控制权
③ DMA 在获得总线后直接在主存 ↔ I/O 之间传输
④ 传输完成后通过中断通知 CPU
```
- 工作方式：字节传送、块传送、周期窃取、透明传送
- **优点**：减少CPU干预、提高吞吐
- **限制**：主存与I/O带宽受总线冲突影响

---

## 五、中断系统

### 1. 中断类型
| 类型 | 触发方式 | 举例 |
|------|----------|------|
| 外部中断 | 外设请求 | 键盘输入、定时器 |
| 内部中断 | 指令异常 | 溢出、非法操作码 |
| 访管指令 | 特权调用 | OS服务调用 |

### 2. 中断响应流程
1. CPU 完成当前指令
2. 保存现场（PC、PSW）
3. 分析中断源（中断向量表）
4. 执行中断服务程序 (ISR)
5. 恢复现场，返回原程序

### 3. 中断优先级与屏蔽
- 多级优先级；高优先级可打断低优先级
- 屏蔽字：控制哪些中断能被响应
- 嵌套中断：ISR 中再次响应更高优先级中断

---

## 六、易错点总结

### 总线与性能
- **总线带宽** = 数据线宽度 (bit) × 总线频率
- **总线冲突**：多个设备同时请求总线 → 需仲裁

### DMA 与 Cache 冲突（高频考点）
```
问题：
  DMA绕过CPU直接访问主存
  → CPU的Cache中可能有旧数据
  → 数据不一致

解决方案：
  1. 硬件方案：Cache一致性协议（MESI）
  2. 软件方案：DMA前清空Cache / DMA后刷新Cache
  3. 混合方案：DMA通知Cache更新
```

### 中断处理
- **现场保存顺序**：先硬件自动保存PC/PSW，再由软件决定是否保存寄存器
- **中断嵌套**：高优先级中断可打断低优先级ISR
- **程序查询 vs 中断**：判断关键在于 CPU 是否需要主动轮询

---

详尽流程、时序图与计算示例请见原主题 `22~25`。
