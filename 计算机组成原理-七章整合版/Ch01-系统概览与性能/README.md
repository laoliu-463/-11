# Ch01 系统概览与性能

> 覆盖 30 篇详细笔记中的主题：01 计算机体系结构概述、29 性能优化、30 综合应用  
> 最后更新：2025 年 1 月

---

## 📚 章节结构与映射

| 本章分节 | 对应原主题 | 核心问题 |
|----------|-------------|-----------|
| 1. 体系结构全景 | 01 | 计算机系统由哪些层级构成？ISA、微体系结构、物理实现的职责是什么？ |
| 2. 性能指标与量化分析 | 29 | 执行时间、CPI、MIPS、加速比等指标如何计算？如何读懂性能题？ |
| 3. 性能优化策略 | 29 | 从硬件、编译、软件与系统角度分别有哪些可落地的优化手段？ |
| 4. 综合应用与设计框架 | 30 | 面对综合题如何拆解需求、做性能评估、输出优化建议？ |
| 5. 高频示例与复盘清单 | 01/29/30 | 通过例题巩固公式，列出考前自查表。 |

---

## 1. 体系结构全景（主题 01）

### 1.1 冯诺依曼 vs 哈佛
- **冯诺依曼结构**：指令与数据共享存储空间，控制器按序取指 → 结构简单但存在取指/访存冲突。
- **哈佛结构**：指令、数据分离，现代 CPU 采用改进型哈佛 → 支持并行取指/访存，但硬件复杂。

### 1.2 三层体系结构模型
```
┌──────────────┐ 应用层        ← 用户/编程视角
│    ISA        │ 指令格式、寻址方式、寄存器可见
├──────────────┤ 微体系结构    ← 设计实现层
│ Pipeline/Cache │ 流水线、乱序、预测、Cache
├──────────────┤ 物理实现      ← 硬件制造层
│ 电路/布线      │ 门级逻辑、晶体管、布局布线
└──────────────┘
```
- **ISA** 定义“做什么”。
- **微体系结构** 决定“怎么做”。
- **物理实现** 负责具体“用什么电路实现”。

### 1.3 408 考试知识地图
- 数据表示、指令系统、CPU、存储层次、I/O、系统性能。
- 综合题常追踪：指令 → CPU 执行 → Cache ↔ 主存 → I/O。

---

## 2. 性能指标与量化分析（主题 29）

### 2.1 基础公式
| 指标 | 公式 | 说明 |
|------|------|------|
| **执行时间** | `指令数 × CPI × 时钟周期` = `指令数 × CPI / 频率` | 408 计算题最常用 |
| **CPI** | `总时钟周期 / 指令数` | 每条指令平均周期数 |
| **MIPS** | `指令数 / 执行时间 / 10^6` 或 `频率 / CPI / 10^6` | 吞吐率指标 |
| **性能** | `1 / 执行时间` | 性能与延迟互为倒数 |

> **常见陷阱**：单位换算（ns/μs/ms、MHz/GHz）必须统一；MIPS 不可单独比较不同 ISA 的性能。

### 2.2 Amdahl 定律
```
加速比 S = 1 / [(1 - P) + P / N]
```
- `P`：可并行部分比例；`N`：并行加速倍数。
- **结论**：优化收益取决于“串行部分”——找准真正的热点。

### 2.3 流水线性能回顾
- 理想加速比：`k` 级流水线在 `n → ∞` 时接近 `k`。
- 实际执行时间：`(k + n - 1) × Δt`。
- 需考虑冒险、停顿导致的 CPI 增加。

---

## 3. 性能优化策略（主题 29）

### 3.1 多层视角
| 视角 | 具体手段 |
|------|-----------|
| **硬件** | 提高主频、增加流水线深度、扩大 Cache、引入预测、增加执行单元 |
| **微体系结构** | 超标量、乱序执行、分支预测、投机执行 |
| **编译器** | 循环展开、指令调度、寄存器分配、内联、自动矢量化 |
| **软件** | 算法重构、数据局部性优化（块化、空间/时间局部性）、并行化 |
| **系统** | DMA、I/O 并行、减少上下文切换、调优内核参数 |

### 3.2 瓶颈定位建议
1. **性能 = f(指令数, CPI, 频率)** → 调整任一部分都会影响总性能。
2. **数据驱动**：使用统计（如 Cache 命中率、分支预测命中率、吞吐率）找出真正的瓶颈。
3. **平衡设计**：性能、功耗、成本三者需权衡，考题常要求论述权衡理由。

---

## 4. 综合应用与设计题框架（主题 30）

### 4.1 设计题套路
1. **需求拆解**：吞吐 vs 延迟、功耗 vs 成本、实时性 vs 一致性。
2. **体系结构选择**：ISA 类型、流水线级数、Cache 层次、I/O 策略。
3. **性能评估**：列出公式（CPI、AMAT、加速比）+ 代数值。
4. **优化方案**：至少给出两种备选方案并比较优缺点。

### 4.2 综合分析链路
```
输入(指令/数据) → CPU 执行链路 → 存储层次(Cache↔主存↔辅存) → I/O 设备
        ↑             ↑                       ↑
     编译优化      流水线/预测          DMA/中断
```
- 题目给出访存统计 + 命中率：先算访存次数，再算 `AMAT`。
- 涉及 I/O 与 CPU 并行：关注 CPU 占用、DMA/中断对调度的影响。

### 4.3 综合案例模板
| 步骤 | 内容 |
|------|------|
| **问题定义** | 列出输入规模、性能指标、约束条件 |
| **基线方案** | 计算基线执行时间 / 带宽 |
| **优化点** | 确认硬件 vs 软件 vs 系统的可调节点 |
| **量化评估** | 使用表格展示“优化前/后”的指标对比 |
| **落地建议** | 指出风险（如功耗、面积）并给出权衡理由 |

---

## 5. 高频示例与复盘清单

### 5.1 例题速览
1. **性能计算**：1000 条指令，CPI=2，频率 2GHz → `执行时间 = 1µs`，`MIPS = 1000`。
2. **Amdahl**：30% 可并行，4 核 → `S ≈ 1.29`。
3. **Cache AMAT**：命中 1ns，命中率 90%，主存 100ns → `AMAT = 11ns`。

### 5.2 自查表
| 检查项 | 说明 |
|--------|------|
| 区分 ISA 与微体系结构 | 面试/大题必问 |
| CPI / 执行时间 / 性能 关系清晰 | 单位统一，写出公式再代数值 |
| 会应用 Amdahl 定律 | 注意串行部分 |
| 会画存储层次示意图 | 强化局部性思维 |
| 了解 DMA/Cache/流水线互相影响 | 综合题常见 |
| 能整理分支预测与流水线冒险 | 现代处理器关键 |

---

## 6. 拓展阅读与附录
- 更细节的推导与例题：参见 `计算机组成原理/1-核心笔记/精简版/01、29、30` 原始笔记。
- 若需要“性能调优 checklist”，可结合 `快速查询表-高频考点.md` 中的性能部分使用。

---

**完成度提示**：本章内容已直接整合 01/29/30 主题的核心段落，不再依赖旧 A1 文件。阅读本章即可掌握系统全景、性能指标与综合应用的必备细节。
