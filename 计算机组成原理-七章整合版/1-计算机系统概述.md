# 第1章：计算机系统概述

> 汇总主题 01（体系结构）、28（程序执行过程）、29（性能优化）、30（综合应用）的核心内容  
> 最后更新：2025 年 1 月

---

## 📑 目录

- [一、体系结构与发展脉络](#一体系结构与发展脉络)
- [二、程序执行全流程](#二程序执行全流程)
- [三、性能指标与计算公式](#三性能指标与计算公式)
- [四、性能优化策略](#四性能优化策略)
- [五、综合应用与设计思维](#五综合应用与设计思维)
- [六、复盘清单与示例](#六复盘清单与示例)

---

## 一、体系结构与发展脉络

### 1.1 体系结构 vs. 组成原理
- **体系结构（Architecture）**：程序员可见的接口，定义“做什么”——指令集、寄存器、数据类型、I/O 机制。
- **组成原理（Organization）**：硬件实现细节，回答“怎么做”——流水线、Cache、电路实现。

```
体系结构 = 建筑蓝图（功能）
组成原理 = 施工方案（实现）
```

### 1.2 三层体系结构
```
┌──────────────┐  ISA：指令格式、寻址方式、寄存器
├──────────────┤  微体系结构：流水线、Cache、分支预测
└──────────────┘  物理实现：晶体管、电路、工艺
```
- ISA 定义接口；微体系结构决定性能；物理实现受制程、功耗、面积限制。

### 1.3 冯诺依曼与改进型哈佛
| 特性 | 冯诺依曼 | 改进型哈佛 |
|------|----------|------------|
| 存储 | 程序/数据共享 | 程序/数据分离 |
| 总线 | 单一总线 | 指令/数据双总线 |
| 优点 | 结构简单 | 并行取指/访存、冲突少 |
| 场景 | 通用计算机 | MCU、DSP、现代 CPU 混合结构 |

五大部件：运算器、控制器、存储器、输入、输出 → 体现“存储程序”思想。

### 1.4 发展里程碑
1. **电子管时代（1946）**：ENIAC，体积大、耗电高。
2. **晶体管时代（1958）**：IBM 7090，可靠性与速度提升。
3. **中小规模集成（1965）**：IBM System/360，兼容架构兴起。
4. **微处理器时代（1971~）**：Intel 4004，PC 普及，多核/超线程。
5. **超大规模集成（未来）**：AI/量子芯片，关注能效与异构协同。

---

## 二、程序执行全流程

### 2.1 三阶段概览
| 阶段 | 主要任务 | 产物 |
|------|----------|------|
| 编译 | 预处理、编译、汇编、链接 | 可执行文件 |
| 加载 | OS 建立进程、装载代码/数据、初始化 PC/SP | 内存中的进程映像 |
| 执行 | CPU 取指→译码→执行→访存→写回 | 程序结果 |

### 2.2 典型流程
```
源代码 → 预处理 (#include/#define)
        → 编译（语法分析、目标代码）
        → 汇编（机器码）
        → 链接（合并库/符号）
        → 可执行文件 (.exe/.out)
        → 操作系统加载（建立 PCB、映射虚拟内存）
        → CPU 运行（取指-译码-执行 循环）
```

### 2.3 进程内存布局
```
高地址 ── 内核空间
        └─ 栈 (向下增长)：函数调用、局部变量
        └─ 空闲区
        └─ 堆 (向上增长)：动态分配
        └─ BSS（未初始化数据）
        └─ Data（初始化数据）
低地址 ── Text（代码指令）
```

---

## 三、性能指标与计算公式

### 3.1 基础指标
| 指标 | 公式 | 说明 |
|------|------|------|
| 执行时间 | `指令数 × CPI × 时钟周期` = `指令数 × CPI / 频率` | 性能 = 1 / 执行时间 |
| CPI | `总时钟周期 / 指令数` | 流水线理想为 1，受冒险影响 |
| MIPS | `频率 / CPI / 10^6` | 不同 ISA 不可直接比较 |
| 加速比 | `T_old / T_new` | Amdahl 定律：`S = 1 / [(1-P) + P/N]` |

### 3.2 常见计算示例
1. **基本性能**：1000 指令、CPI=2、频率 2GHz → `T=1µs`，`MIPS=1000`。
2. **Amdahl**：30% 可并行、4 核 → `S=1/[0.7+0.3/4]≈1.29`。
3. **AMAT**：Cache 1ns、命中率 90%、主存 100ns → `1 + 0.1×100 = 11ns`。

---

## 四、性能优化策略

### 4.1 多层视角
| 视角 | 关键手段 |
|------|----------|
| 硬件/工艺 | 提高主频、改进制程、优化电源/时钟分配 |
| 微体系结构 | 深/宽流水线、超标量、乱序执行、分支预测、投机执行 |
| 存储系统 | 多级 Cache、提高命中率、合理写策略、TLB/虚拟存储优化 |
| 编译器 | 循环展开、指令调度、寄存器分配、自动矢量化 |
| 软件/系统 | 算法重构、数据局部性优化、并行化、DMA、中断/任务调度 | 

### 4.2 性能瓶颈排查
1. **CPU 瓶颈**：CPI 高、分支失误 → 调整算法/预测、前递、减少阻塞。
2. **存储瓶颈**：命中率低、缺页 → 增大 Cache、提高相联度、优化访问模式。
3. **I/O 瓶颈**：磁盘/网络慢 → DMA、中断优先级、磁盘调度（SCAN）。

### 4.3 平衡思路
- 定位热点 → 针对性优化 → 评估收益/成本 → 防止局部过度优化。
- 性能、功耗、面积/成本需三者权衡，考试常要求写出理由。

---

## 五、综合应用与设计思维

### 5.1 知识图谱（主题 30）
1. **基础概念**：体系结构、数据组织、编码。
2. **数据表示与运算**：定点/浮点/移位/误差。
3. **指令系统**：格式、寻址、指令类型、RISC vs CISC。
4. **CPU 与控制**：结构、执行周期、控制器、流水线、条件执行。
5. **存储系统**：层次结构、Cache、虚拟/辅存。
6. **总线与 I/O**：总线、接口、DMA、中断。
7. **程序执行**：子程序、函数、执行流程、性能指标。

### 5.2 场景化分析
- **指令执行优化**：5 级流水线 + 前递 + 分支预测 + 分离指令/数据 Cache。
- **存储系统设计**：寄存器→L1→L2→L3→主存→辅存，常见策略：组相联、LRU、写回、TLB。
- **I/O 与系统**：DMA 减轻 CPU，占 I/O 中断优先级，磁盘调度用 SCAN/LOOK。

### 5.3 设计题套路
1. **需求拆解**：吞吐 vs 延迟、功耗 vs 成本、实时性 vs 一致性。
2. **方案设计**：选择 ISA、流水线级数、Cache 层数、I/O 机制。
3. **量化评估**：列公式 (CPI、AMAT、带宽) 并比较“优化前/后”。
4. **风险提示**：如功耗、面积、复杂度，说明取舍理由。

---

## 六、复盘清单与示例

### 6.1 高频自查
| 检查项 | 说明 |
|--------|------|
| 区分 ISA / 微体系结构 / 物理实现 | 面试与大题基础 |
| 会画冯诺依曼/哈佛 + 存储层次图 | 理解数据/指令流 |
| 熟练“编译→加载→执行”流程 | 代码到机器的桥梁 |
| CPI / 执行时间 / MIPS 的单位 | 代公式前先统一单位 |
| 会用 Amdahl 定律与 AMAT | 并行与存储性能核心 |
| 知道 DMA 与 Cache 不一致性 | 说明解决办法（刷新 / 一致性协议） |
| 设计题套路 | 需求→结构→评估→权衡 |

### 6.2 快速示例
1. **性能计算**：题目给出指令数、CPI、频率 → 写出公式再代数值。
2. **流水线冒险**：画 5 级流水线时序，标 RAW/WAR/WAW，说明前递或插入气泡。
3. **Cache 地址划分**：指定容量/相联度/块大小 → 列 Tag/Index/Offset 位数。
4. **程序执行**：解释为何“加载阶段”需要设置 PC/SP，并画栈帧结构（返回地址→参数→旧 BP→局部变量）。

---

**提示**：本章已整合 01/28/29/30 的关键内容，旧版 A1 文件不再需要。若需更细节的推导或题解，可前往 `计算机组成原理/1-核心笔记/精简版/01、28、29、30` 查阅原始笔记。

